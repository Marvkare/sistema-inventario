<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sistema de Resguardos{% endblock %}</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Paleta oficial "Atitalaquia Se Transforma 2024-2027" */
            --color-burgundy: 106, 46, 77;     /* #6A2E4D - Borgoña Institucional */
            --color-beige: 188, 155, 106;      /* #BC9B6A - Beige Arena */
            --color-white: 255, 255, 255;      /* #FFFFFF - Blanco */
            
            /* Colores adicionales para el diseño */
            --color-burgundy-dark: 85, 30, 58; /* #551E3A - Borgoña Oscuro */
            --color-burgundy-light: 125, 60, 95; /* #7D3C5F - Borgoña Claro */
            --color-beige-dark: 160, 130, 85;  /* #A08255 - Beige Oscuro */
            --color-beige-light: 215, 195, 160; /* #D7C3A0 - Beige Claro */
            --color-gray: 245, 245, 245;       /* #F5F5F5 - Gris Claro */
            
            /* Gradientes */
            --gradient-primary: linear-gradient(135deg, #6A2E4D 0%, #551E3A 100%);
            --gradient-accent: linear-gradient(135deg, #BC9B6A 0%, #A08255 100%);
            --gradient-content: linear-gradient(135deg, #FFFFFF 0%, #F5F5F5 100%);
            --gradient-header: linear-gradient(90deg, rgba(106, 46, 77, 0.9) 0%, rgba(85, 30, 58, 0.9) 100%);
            --gradient-indicator: linear-gradient(180deg, #BC9B6A 0%, #A08255 100%);
            
            /* Texto */
            --text-light: 255, 255, 255;       /* Blanco */
            --text-muted: 215, 195, 160;       /* Beige Claro */
            --text-dark: 106, 46, 77;          /* Borgoña */
            
            /* Fondos y bordes */
            --bg-overlay: 255, 255, 255;       /* Blanco */
            --bg-overlay-opacity: 0.08;
            --border-overlay: 255, 255, 255;
            --border-overlay-opacity: 0.15;
            
            /* Estados hover/active */
            --hover-opacity: 0.25;
            --active-opacity: 0.35;
            --border-hover-opacity: 0.4;
            --border-active-opacity: 0.6;
            
            /* Sombras */
            --shadow-color: 106, 46, 77;
            --shadow-opacity: 0.2;
            --shadow-active-opacity: 0.3;
            
            /* Transiciones */
            --transition-duration: 0.3s;
            --transition-timing: ease-out;
        }

        * {
            box-sizing: border-box;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--gradient-primary);
            margin: 0;
            padding: 0;
        }
        
        .sidebar-gradient {
            background: var(--gradient-primary);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 40;
        }
        
        .nav-link { 
            display: flex;
            align-items: center;
            padding: 0.75rem;
            font-weight: 500;
            border-radius: 0.75rem;
            transition: all 0.3s var(--transition-timing);
            color: rgb(var(--text-muted));
            background: rgba(var(--bg-overlay), var(--bg-overlay-opacity));
            border: 1px solid rgba(var(--border-overlay), var(--border-overlay-opacity));
        }
        
        .nav-link:hover {
            background: rgba(var(--color-beige), var(--hover-opacity));
            border-color: rgba(var(--color-beige), var(--border-hover-opacity));
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(var(--shadow-color), var(--shadow-opacity));
            color: rgb(var(--text-light));
        }
        
        .nav-link.active {
            background: rgba(var(--color-beige), var(--active-opacity));
            border-color: rgba(var(--color-beige), var(--border-active-opacity));
            box-shadow: 0 4px 12px rgba(var(--color-beige), var(--shadow-active-opacity));
            color: rgb(var(--text-light));
        }
        
        .nav-link i { 
            width: 1.5rem;
            text-align: center;
            font-size: 1.125rem;
            transition: transform var(--transition-duration);
        }
        
        .nav-link:hover i {
            transform: scale(1.1);
        }
        
        .menu-toggle {
            background: var(--gradient-accent);
            box-shadow: 0 4px 15px rgba(var(--shadow-color), 0.25);
            transition: all var(--transition-duration) ease;
            border: 2px solid rgb(var(--color-burgundy-dark));
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            z-index: 50;
            padding: 0.75rem;
            color: rgb(var(--color-burgundy));
            border-radius: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .menu-toggle:hover {
            box-shadow: 0 6px 20px rgba(var(--shadow-color), 0.35);
            filter: brightness(1.1);
        }
        
        .menu-toggle:active {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }
        
        .sidebar-header {
            background: var(--gradient-header);
            border-bottom: 2px solid rgba(var(--color-beige), 0.3);
        }
        
        .scrollbar-custom::-webkit-scrollbar {
            width: 4px;
        }
        
        .scrollbar-custom::-webkit-scrollbar-track {
            background: rgba(var(--color-beige), 0.1);
            border-radius: 10px;
        }
        
        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: rgba(var(--color-beige), 0.5);
            border-radius: 10px;
        }
        
        .scrollbar-custom::-webkit-scrollbar-thumb:hover {
            background: rgba(var(--color-beige), 0.7);
        }
        
        .menu-indicator {
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 0;
            background: var(--gradient-indicator);
            border-radius: 2px;
            transition: all var(--transition-duration) ease;
        }
        
        .nav-link:hover .menu-indicator {
            height: 20px;
        }
        
        .nav-link.active .menu-indicator {
            height: 30px;
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .main-content-gradient {
            background: var(--gradient-content);
            min-height: 100vh;
        }

        /* Clases de utilidad basadas en variables */
        .text-burgundy {
            color: rgb(var(--color-burgundy));
        }
        
        .text-beige {
            color: rgb(var(--color-beige));
        }
        
        .bg-burgundy {
            background-color: rgb(var(--color-burgundy));
        }
        
        .bg-beige {
            background-color: rgb(var(--color-beige));
        }
        
        .border-beige {
            border-color: rgb(var(--color-beige));
        }
        
        .gold-text {
            color: rgb(var(--color-beige));
            text-shadow: 0 1px 2px rgba(var(--color-burgundy), 0.3);
        }

        /* Overlay para cerrar menú en móvil */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 35;
        }

        @media (max-width: 767px) {
            .sidebar-overlay.active {
                display: block;
            }
            
            .menu-toggle {
                position: fixed;
                top: 1.5rem;
                left: 1.5rem;
                transform: none !important;
            }
        }

        /* Estados específicos para el menú abierto/cerrado */
        .sidebar-open .menu-toggle {
            left: calc(288px + 1.5rem); /* 72 * 4 = 288px + 1.5rem */
        }
        
        @media (max-width: 767px) {
            .sidebar-open .menu-toggle {
                left: calc(100% - 4.5rem);
            }
        }
    </style>
    
    {% block styles %}{% endblock %} 
    {% block head %}{% endblock %}
</head>
<body class="overflow-hidden">

    <!-- Overlay para móvil -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Sidebar con Paleta "Atitalaquia Se Transforma" -->
    <aside id="sidebar" class="fixed top-0 left-0 z-40 w-72 h-screen sidebar-gradient p-0 flex flex-col border-r border-beige shadow-2xl transition-all duration-500 ease-in-out transform -translate-x-full">
        <!-- Header del Sidebar -->
        <div class="sidebar-header p-6 flex-shrink-0">
            <div class="flex items-center space-x-3">
               <div class="w-12 h-12 rounded-xl flex items-center justify-center shadow-lg" 
                style="background: linear-gradient(135deg, rgb(var(--color-beige)) 0%, rgb(var(--color-beige-light)) 100%); border: 2px solid rgb(var(--color-beige-light));">
                <i class="fas fa-shield-alt text-xl font-bold" style="color: rgb(var(--color-burgundy));"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold gold-text">ATITALAQUIA</h1>
                    <p class="text-sm text-white mt-1 font-semibold">SE TRANSFORMA</p>
                    <p class="text-xs text-beige mt-1">2024-2027</p>
                </div>
            </div>
        </div>
        
        <!-- Navegación -->
        <div class="flex-grow overflow-y-auto py-4 px-4 scrollbar-custom">
            <ul class="space-y-2">
                <!-- Grupo: Gestión Principal -->
                <li class="px-3 py-2">
                    <p class="text-xs font-semibold text-beige-light uppercase tracking-wider mb-2 flex items-center">
                        <i class="fas fa-tachometer-alt mr-2 text-beige"></i>
                        Gestión Principal
                    </p>
                </li>
                
                <li class="relative">
                    <a href="{{ url_for('bienes.agregar_bien') }}" class="nav-link group">
                        <div class="menu-indicator"></div>
                        <i class="fas fa-plus-circle fa-fw mr-3 text-beige-light"></i>
                        <span>Formulario de Bienes</span>
                        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
                    </a>
                </li>
                
                <li class="relative">
                    <a href="{{ url_for('resguardos.crear_resguardo') }}" class="nav-link group">
                        <div class="menu-indicator"></div>
                        <i class="fas fa-file-signature fa-fw mr-3 text-beige-light"></i>
                        <span>Formulario de Resguardo</span>
                        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
                    </a>
                </li>
                
                <li class="relative">
                    <a href="{{ url_for('resguardos.carga_masiva') }}" class="nav-link group">
                        <div class="menu-indicator"></div>
                        <i class="fas fa-file-upload fa-fw mr-3 text-beige-light"></i>
                        <span>Carga Masiva</span>
                        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
                    </a>
                </li>

                <!-- Grupo: Consultas y Reportes -->
                <li class="px-3 py-2 mt-6">
                    <p class="text-xs font-semibold text-beige-light uppercase tracking-wider mb-2 flex items-center">
                        <i class="fas fa-chart-bar mr-2 text-beige"></i>
                        Consultas y Reportes
                    </p>
                </li>
                
                <li class="relative">
                    <a href="{{ url_for('bienes.listar_bienes') }}" class="nav-link group">
                        <div class="menu-indicator"></div>
                        <i class="fas fa-boxes fa-fw mr-3 text-beige-light"></i>
                        <span>Ver Todos los Bienes</span>
                        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
                    </a>
                </li>
                
                <li class="relative">
                    <a href="{{ url_for('resguardos.ver_resguardos') }}" class="nav-link group">
                        <div class="menu-indicator"></div>
                        <i class="fas fa-list-ul fa-fw mr-3 text-beige-light"></i>
                        <span>Ver Todos los Resguardos</span>
                        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
                    </a>
                </li>
                
                <li class="relative">
                    <a href="{{ url_for('resguardos.ver_resguardos_sujeto_control') }}" class="nav-link group">
                        <div class="menu-indicator"></div>
                        <i class="fas fa-sort-amount-down-alt fa-fw mr-3 text-beige-light"></i>
                        <span>Tabla Sujeto Control</span>
                        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
                    </a>
                </li>

                <!-- Grupo: Configuración -->
                <li class="px-3 py-2 mt-6">
                    <p class="text-xs font-semibold text-beige-light uppercase tracking-wider mb-2 flex items-center">
                        <i class="fas fa-cogs mr-2 text-beige"></i>
                        Configuración
                    </p>
                </li>
                
                <li class="relative">
                    <a href="{{ url_for('errors.handle_errors') }}" class="nav-link group">
                        <div class="menu-indicator"></div>
                        <i class="fas fa-exclamation-triangle fa-fw mr-3 text-beige-light"></i>
                        <span>Revisar Errores</span>
                        <span class="pulse-dot w-2 h-2 bg-red-400 rounded-full ml-auto"></span>
                    </a>
                </li>
                
                <li class="relative">
                    <a href="{{ url_for('plantillas.crear_plantilla') }}" class="nav-link group">
                        <div class="menu-indicator"></div>
                        <i class="fas fa-magic fa-fw mr-3 text-beige-light"></i>
                        <span>Crear Plantilla</span>
                        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
                    </a>
                </li>
                
                <li class="relative">
                    <a href="{{ url_for('plantillas.ver_plantillas') }}" class="nav-link group">
                        <div class="menu-indicator"></div>
                        <i class="fas fa-file-alt fa-fw mr-3 text-beige-light"></i>
                        <span>Ver Plantillas</span>
                        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
                    </a>
                </li>
                
                <li class="relative">
                    <a href="{{ url_for('areas.manage_areas') }}" class="nav-link group">
                        <div class="menu-indicator"></div>
                        <i class="fas fa-building fa-fw mr-3 text-beige-light"></i>
                        <span>Gestionar Áreas</span>
                        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
                    </a>
                </li>
                
                <li class="relative">
                    <a href="{{ url_for('etiquetas.imprimir_etiquetas') }}" class="nav-link group">
                        <div class="menu-indicator"></div>
                        <i class="fas fa-tags fa-fw mr-3 text-beige-light"></i>
                        <span>Imprimir Etiquetas</span>
                        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
                    </a>
                </li>
<li class="px-3 py-2 mt-6">
    <p class="text-xs font-semibold text-beige-light uppercase tracking-wider mb-2 flex items-center">
        <i class="fas fa-warehouse mr-2 text-beige"></i>
        Bajas e Inventarios
    </p>
</li>

<li class="relative">
    <a href="{{ url_for('bajas.gestionar_bajas') }}" class="nav-link group">
        <div class="menu-indicator"></div>
        <i class="fas fa-box-open fa-fw mr-3 text-beige-light"></i>
        <span>Gestionar bajas</span>
        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
    </a>
</li>

<li class="relative">
    <a href="{{ url_for('inventarios.listar_inventarios') }}" class="nav-link group">
        <div class="menu-indicator"></div>
        <i class="fas fa-list-ul fa-fw mr-3 text-beige-light"></i>
        <span>Ver inventarios</span>
        <i class="fas fa-chevron-right ml-auto text-xs text-beige-light group-hover:text-white transition-colors"></i>
    </a>
</li>
            </ul>
        </div>

        <!-- Footer del Sidebar -->
        <div class="p-4 border-t border-beige flex-shrink-0">
            <div class="text-center">
                <p class="text-xs text-beige-light font-semibold">Sistema de Resguardos</p>
                <p class="text-xs text-beige mt-1">ATITALAQUIA SE TRANSFORMA</p>
                <p class="text-xs text-beige-dark mt-1">© 2024-2027 Todos los derechos reservados</p>
            </div>
        </div>
    </aside>

    <!-- Botón de Toggle - POSICIÓN FIJA -->
    <button id="menu-toggle" class="menu-toggle">
        <i id="menu-icon" class="fas fa-bars text-lg font-bold"></i>
    </button>

    <!-- Contenido Principal -->
    <main id="main-content" class="flex-grow h-screen overflow-y-auto transition-all duration-500 ease-in-out main-content-gradient ml-0">
        
        <!-- Mensajes Flash Mejorados -->
        <div id="flash-container" class="fixed top-6 right-6 z-[1050] w-full max-w-md space-y-3">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="flash-message p-4 rounded-xl shadow-2xl border-l-4 transform transition-all duration-500 ease-out animate-slide-in-right
                            {% if category == 'success' %} bg-gradient-to-r from-green-50 to-emerald-50 border-green-600 text-green-800 
                            {% elif category == 'danger' %} bg-gradient-to-r from-red-50 to-pink-50 border-red-600 text-red-800 
                            {% else %} bg-gradient-to-r from-beige-light to-beige border-beige-dark text-burgundy {% endif %}">
                            <div class="flex items-center">
                                <i class="fas {% if category == 'success' %}fa-check-circle{% elif category == 'danger' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} mr-3 text-lg"></i>
                                <div class="flex-1">
                                    <p class="font-semibold">{{ message }}</p>
                                </div>
                                <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>

        {% block content %}{% endblock %}
        
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Sistema de persistencia del estado del menú
            const MENU_STATE_KEY = 'sidebarState';
            
            // Elementos del DOM
            const menuToggleBtn = document.getElementById('menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const menuIcon = document.getElementById('menu-icon');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const body = document.body;

            // Estado del menú
            let isMenuOpen = false;

            // Funciones para manejar el estado
            const saveMenuState = (isOpen) => {
                localStorage.setItem(MENU_STATE_KEY, isOpen ? 'open' : 'closed');
            };

            const getMenuState = () => {
                return localStorage.getItem(MENU_STATE_KEY) || 'closed';
            };

            const openMenu = () => {
                console.log('Abriendo menú...');
                sidebar.classList.remove('-translate-x-full');
                sidebar.classList.add('translate-x-0');
                mainContent.classList.add('md:ml-72');
                body.classList.add('sidebar-open');
                menuIcon.classList.remove('fa-bars');
                menuIcon.classList.add('fa-times');
                
                // Mostrar overlay en móvil
                if (window.innerWidth < 768) {
                    sidebarOverlay.classList.add('active');
                }
                
                isMenuOpen = true;
                saveMenuState(true);
            };

            const closeMenu = () => {
                console.log('Cerrando menú...');
                sidebar.classList.remove('translate-x-0');
                sidebar.classList.add('-translate-x-full');
                mainContent.classList.remove('md:ml-72');
                body.classList.remove('sidebar-open');
                menuIcon.classList.remove('fa-times');
                menuIcon.classList.add('fa-bars');
                
                // Ocultar overlay en móvil
                sidebarOverlay.classList.remove('active');
                
                isMenuOpen = false;
                saveMenuState(false);
            };

            const toggleMenu = () => {
                console.log('Toggle menu, estado actual:', isMenuOpen);
                if (isMenuOpen) {
                    closeMenu();
                } else {
                    openMenu();
                }
            };

            // Inicializar estado del menú
            const initializeMenuState = () => {
                const savedState = getMenuState();
                console.log('Estado guardado:', savedState);
                
                if (window.innerWidth >= 768) {
                    // En desktop
                    if (savedState === 'open') {
                        openMenu();
                    } else {
                        closeMenu();
                    }
                } else {
                    // En móvil siempre cerrado al inicio
                    closeMenu();
                }
            };

            // Manejo de mensajes flash
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(msg => {
                setTimeout(() => {
                    msg.style.transition = 'all 0.5s ease-in-out';
                    msg.style.opacity = '0';
                    msg.style.transform = 'translateX(100%) scale(0.9)';
                    setTimeout(() => {
                        if (msg.parentNode) {
                            msg.parentNode.removeChild(msg);
                        }
                    }, 500);
                }, 5000);
            });

            // Event listeners
            menuToggleBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log('Click en botón toggle');
                toggleMenu();
            });

            // Cerrar menú al hacer clic en el overlay (móvil)
            sidebarOverlay.addEventListener('click', (e) => {
                e.preventDefault();
                console.log('Click en overlay');
                closeMenu();
            });

            // Cerrar menú al hacer clic en un enlace del menú (móvil)
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    if (window.innerWidth < 768) {
                        console.log('Click en enlace móvil');
                        closeMenu();
                    }
                });
            });

            // Manejar redimensionamiento
            window.addEventListener('resize', () => {
                console.log('Resize window');
                if (window.innerWidth >= 768) {
                    // En desktop, restaurar estado guardado
                    const savedState = getMenuState();
                    if (savedState === 'open') {
                        openMenu();
                    }
                    // Ocultar overlay en desktop
                    sidebarOverlay.classList.remove('active');
                } else {
                    // En móvil, asegurarse de que esté cerrado
                    closeMenu();
                }
            });

            // Inicializar
            initializeMenuState();

            // Agregar clase active al enlace actual
            const currentPath = window.location.pathname;
            document.querySelectorAll('.nav-link').forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                }
            });

            // Debug
            console.log('Elementos cargados:');
            console.log('Menu toggle:', menuToggleBtn);
            console.log('Sidebar:', sidebar);
            console.log('Menu icon:', menuIcon);
        });
        
    </script>
    
    <style>
        @keyframes slide-in-right {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .animate-slide-in-right {
            animation: slide-in-right 0.5s ease-out;
        }
    
    
    </style>
    
    {% block scripts %}{% endblock %}
</body>
</html>