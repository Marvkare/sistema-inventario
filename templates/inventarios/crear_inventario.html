{% extends "base.html" %}

{% block title %}Crear Nuevo Inventario{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-beige-light/20 py-8 px-4">
    <div class="max-w-4xl mx-auto">
        
        <!-- Encabezado -->
        <div class="bg-white rounded-2xl shadow-xl border border-beige-light overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-burgundy to-burgundy-dark p-6 text-white">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div class="flex-1">
                        <h1 class="text-2xl md:text-3xl font-bold">Crear Nuevo Inventario</h1>
                        <p class="text-beige-light mt-2">Complete la información básica para iniciar un nuevo proceso de levantamiento</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-12 h-12 bg-beige rounded-full flex items-center justify-center shadow-lg">
                            <i class="fas fa-clipboard-list text-burgundy text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <form action="{{ url_for('inventarios.crear_inventario') }}" method="POST">
            <div class="space-y-8">
                
                <!-- Información Básica -->
                <div class="bg-white rounded-2xl shadow-lg border border-beige-light overflow-hidden">
                    <div class="p-6">
                        <h2 class="text-xl font-bold text-burgundy mb-4 flex items-center">
                            <i class="fas fa-info-circle mr-3"></i>
                            Información Básica
                        </h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="nombre" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                    <i class="fas fa-tag text-burgundy mr-2 text-xs"></i>
                                    Nombre del Inventario <span class="text-red-600 ml-1">*</span>
                                </label>
                                <input type="text" name="nombre" id="nombre" required
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-burgundy/50 focus:border-burgundy transition-all duration-200 bg-white"
                                       placeholder="Ej: Inventario Anual 2025" value="{{ form_data.nombre }}">
                            </div>
                            
                            <div>
                                <label for="tipo" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                    <i class="fas fa-list-alt text-burgundy mr-2 text-xs"></i>
                                    Tipo de Inventario
                                </label>
                                <select id="tipo" name="tipo"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-burgundy/50 focus:border-burgundy transition-all duration-200 bg-white">
                                    <option {% if form_data.tipo == 'Físico-Contable' %}selected{% endif %}>Físico-Contable</option>
                                    <option {% if form_data.tipo == 'Preventivo' %}selected{% endif %}>Preventivo</option>
                                </select>
                            </div>
                            <div class="mt-6">
                                <label for="Tipo_De_Resguardo" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                    <i class="fas fa-shield-alt text-burgundy mr-2 text-xs"></i>
                                    Tipo de Bienes a Inventariar <span class="text-red-600 ml-1">*</span>
                                </label>
                                <select id="Tipo_De_Resguardo" name="Tipo_De_Resguardo" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-burgundy/50 focus:border-burgundy transition-all duration-200 bg-white">
                                    <option value="0" {% if form_data.Tipo_De_Resguardo == '0' %}selected{% endif %}>Resguardo</option>
                                    <option value="1" {% if form_data.Tipo_De_Resguardo == '1' %}selected{% endif %}>Sujeto a Control</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alcance del Inventario -->
                <div class="bg-white rounded-2xl shadow-lg border border-beige-light overflow-hidden">
                    <div class="p-6">
                        <h2 class="text-xl font-bold text-burgundy mb-4 flex items-center">
                            <i class="fas fa-bullseye mr-3"></i>
                            Alcance del Inventario
                        </h2>
                        <p class="text-gray-600 mb-6">Seleccione las áreas que serán incluidas en este levantamiento</p>
                        
<fieldset>
    <legend class="sr-only">Áreas</legend>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% for area in areas %}
        <div class="relative bg-beige-light/20 p-4 rounded-xl border-2 border-beige-light hover:border-burgundy/50 transition-all duration-200 cursor-pointer area-card"
             data-bienes-normal="{{ area.num_bienes_normal }}"
             data-bienes-control="{{ area.num_bienes_control }}">
            
            <div class="flex items-start space-x-3">
                <div class="flex h-5 items-center mt-1">
                    <input id="area-{{ area.id }}" name="area_ids" value="{{ area.id }}" type="checkbox"
                           class="h-4 w-4 rounded border-gray-300 text-burgundy focus:ring-burgundy/50">
                </div>
                <div class="flex-1">
                    <label for="area-{{ area.id }}" class="block font-bold text-gray-800 cursor-pointer text-sm">
                        {{ area.nombre }}
                    </label>
                    <div class="mt-2 space-y-1 text-xs text-gray-600">
                        <p class="flex items-center">
                            <i class="fas fa-user-tie text-burgundy mr-2"></i>
                            Jefe de Área: <span class="font-medium ml-1">{{ area.jefe_de_area or 'No asignado' }}</span>
                        </p>
                        <p class="flex items-center">
                            <i class="fas fa-boxes text-burgundy mr-2"></i>
                            Bienes a verificar: 
                            <span class="font-bold text-burgundy ml-1 bienes-count">{{ area.num_bienes_normal }}</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</fieldset>
                    </div>
                </div>
                
                <!-- Brigada de Trabajo -->
                <div class="bg-white rounded-2xl shadow-lg border border-beige-light overflow-hidden">
                    <div class="p-6">
                        <h2 class="text-xl font-bold text-burgundy mb-4 flex items-center">
                            <i class="fas fa-users mr-3"></i>
                            Brigada de Trabajo
                        </h2>
                        <p class="text-gray-600 mb-6">Asigne al personal que realizará el trabajo de campo</p>
                        
                        <fieldset>
                            <legend class="sr-only">Usuarios</legend>
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                {% for user in users %}
                                <div class="relative bg-gray-50 p-4 rounded-xl border border-gray-200 hover:border-burgundy/50 transition-all duration-200 cursor-pointer">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex h-5 items-center">
                                            <input id="user-{{ user.id }}" name="user_ids" value="{{ user.id }}" type="checkbox"
                                                   class="h-4 w-4 rounded border-gray-300 text-burgundy focus:ring-burgundy/50">
                                        </div>
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-burgundy rounded-full flex items-center justify-center text-white text-sm font-bold mr-3">
                                                {{ user.username[0]|upper }}
                                            </div>
                                            <label for="user-{{ user.id }}" class="font-medium text-gray-700 cursor-pointer text-sm">
                                                {{ user.username }}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </fieldset>
                    </div>
                </div>
                
                <!-- Botones de Acción -->
                <div class="flex flex-col sm:flex-row justify-end gap-4 pt-6">
                    <a href="{{ url_for('inventarios.listar_inventarios') }}"
                       class="inline-flex items-center justify-center px-6 py-3 border-2 border-gray-300 text-base font-semibold rounded-xl text-gray-700 bg-white hover:bg-gray-50 transition-all duration-200 order-2 sm:order-1">
                        <i class="fas fa-times mr-2"></i> Cancelar
                    </a>
                    <button type="submit"
                            class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-semibold rounded-xl shadow-lg text-white bg-gradient-to-r from-burgundy to-burgundy-dark hover:from-burgundy-dark hover:to-burgundy transition-all duration-300 transform hover:scale-105 order-1 sm:order-2">
                        <i class="fas fa-plus-circle mr-2"></i> 
                        Crear Inventario
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    .bg-burgundy { background-color: #6A2E4D; }
    .bg-burgundy-dark { background-color: #551E3A; }
    .text-burgundy { color: #6A2E4D; }
    .border-burgundy { border-color: #6A2E4D; }
    .focus\:ring-burgundy\/50:focus { --tw-ring-color: rgb(106 46 77 / 0.5); }
    .focus\:border-burgundy:focus { border-color: #6A2E4D; }
    
    .bg-beige { background-color: #BC9B6A; }
    .bg-beige-light { background-color: #D7C3A0; }
    .text-beige-light { color: #D7C3A0; }
    .border-beige { border-color: #BC9B6A; }
    .border-beige-light { border-color: #D7C3A0; }
    
    .from-burgundy { --tw-gradient-from: #6A2E4D; --tw-gradient-to: rgb(106 46 77 / 0); --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); }
    .to-burgundy-dark { --tw-gradient-to: #551E3A; }
</style>
{% endblock %}


{% block scripts %}
<script>
    // Esperamos a que todo el contenido de la página se haya cargado
    document.addEventListener('DOMContentLoaded', function () {
        
        // 1. Seleccionamos los elementos con los que vamos a trabajar
        const tipoResguardoSelect = document.getElementById('Tipo_De_Resguardo');
        const areaCards = document.querySelectorAll('.area-card');

        // 2. Creamos una función para actualizar los contadores
        function actualizarContadores() {
            // Obtenemos el valor seleccionado: '0' para Normal, '1' para Control
            const seleccion = tipoResguardoSelect.value;

            // 3. Recorremos cada tarjeta de área
            areaCards.forEach(card => {
                // Seleccionamos el <span> específico dentro de esta tarjeta
                const contadorSpan = card.querySelector('.bienes-count');
                let numeroBienes = 0;

                // 4. Decidimos qué número mostrar basado en la selección
                if (seleccion === '0') {
                    // Si es 'Resguardo', tomamos el valor de data-bienes-normal
                    numeroBienes = card.dataset.bienesNormal;
                } else {
                    // Si es 'Sujeto a Control', tomamos el valor de data-bienes-control
                    numeroBienes = card.dataset.bienesControl;
                }

                // 5. Actualizamos el texto del <span> con el número correcto
                contadorSpan.textContent = numeroBienes;
            });
        }

        // 6. Añadimos un "oyente" que llame a nuestra función cada vez que el select cambie
        tipoResguardoSelect.addEventListener('change', actualizarContadores);

        // Opcional pero recomendado: Llama a la función una vez al cargar la página
        // para asegurar que el estado inicial es el correcto.
        actualizarContadores();
    });
</script>
{% endblock %}