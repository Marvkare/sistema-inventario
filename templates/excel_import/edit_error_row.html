{% extends "base.html" %}

{% block title %}Corregir Fila de Importación{% endblock %}

{% block content %}
<div class="page-wrapper">
    <div class="container-limit">
        
        <div class="header-card">
            <div class="header-text">
                <h1>Corregir Fila de Importación</h1>
                <p>
                    Estás editando la fila de error con ID: 
                    <span class="badge badge-mono">{{ error_id }}</span>
                </p>
            </div>
            <div class="header-icon-box">
                <i class="fas fa-edit"></i>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                
                <div class="alert alert-danger mb-4">
                    <div class="alert-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="alert-content">
                        <strong>Error Original:</strong>
                        <p>{{ error_data.error_message }}</p>
                    </div>
                </div>

                <form method="POST" action="{{ url_for('excel_import.edit_error_row', error_id=error_id) }}">
                    
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon"><i class="fas fa-box"></i></div>
                            <h2>Información General del Bien</h2>
                        </div>
                        
                        <div class="form-grid-3">
                            <div class="form-group">
                                <label for="No_Inventario"><i class="fas fa-hashtag icon-label"></i> No. de Inventario</label>
                                <input type="text" name="No_Inventario" value="{{ error_data.No_Inventario or '' }}">
                            </div>
                            <div class="form-group">
                                <label for="Cantidad"><i class="fas fa-cubes icon-label"></i> Cantidad</label>
                                <input type="number" name="Cantidad" value="{{ error_data.Cantidad or '' }}" min="1">
                            </div>
                            <div class="form-group">
                                <label for="Descripcion_Corta_Del_Bien"><i class="fas fa-align-left icon-label"></i> Descripción Corta</label>
                                <input type="text" name="Descripcion_Corta_Del_Bien" value="{{ error_data.Descripcion_Corta_Del_Bien or '' }}">
                            </div>
                            <div class="form-group">
                                <label for="Marca"><i class="fas fa-tag icon-label"></i> Marca</label>
                                <input type="text" name="Marca" value="{{ error_data.Marca or '' }}">
                            </div>
                            <div class="form-group">
                                <label for="Modelo"><i class="fas fa-cube icon-label"></i> Modelo</label>
                                <input type="text" name="Modelo" value="{{ error_data.Modelo or '' }}">
                            </div>
                            <div class="form-group">
                                <label for="Numero_De_Serie"><i class="fas fa-barcode icon-label"></i> Número de Serie</label>
                                <input type="text" name="Numero_De_Serie" value="{{ error_data.Numero_De_Serie or '' }}">
                            </div>
                            <div class="form-group">
                                <label for="Estado_Del_Bien"><i class="fas fa-clipboard-check icon-label"></i> Estado</label>
                                <select name="Estado_Del_Bien">
                                    <option value="">Seleccione...</option>
                                    <option value="Nuevo" {% if error_data.Estado_Del_Bien == 'Nuevo' %}selected{% endif %}>Nuevo</option>
                                    <option value="Bueno" {% if error_data.Estado_Del_Bien == 'Bueno' %}selected{% endif %}>Bueno</option>
                                    <option value="Regular" {% if error_data.Estado_Del_Bien == 'Regular' %}selected{% endif %}>Regular</option>
                                    <option value="Malo" {% if error_data.Estado_Del_Bien == 'Malo' %}selected{% endif %}>Malo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="Tipo_De_Alta"><i class="fas fa-sign-in-alt icon-label"></i> Tipo de Alta</label>
                                <select name="Tipo_De_Alta">
                                    <option value="">Seleccione...</option>
                                    <option value="Compra" {% if error_data.Tipo_De_Alta == 'Compra' %}selected{% endif %}>Compra</option>
                                    <option value="Donacion" {% if error_data.Tipo_De_Alta == 'Donacion' %}selected{% endif %}>Donación</option>
                                    <option value="Comodato" {% if error_data.Tipo_De_Alta == 'Comodato' %}selected{% endif %}>Comodato</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="Clasificacion_Legal"><i class="fas fa-balance-scale icon-label"></i> Clasificación Legal</label>
                                <select name="Clasificacion_Legal">
                                    <option value="">Seleccione...</option>
                                    <option value="Dominio Público" {% if error_data.Clasificacion_Legal == 'Dominio Público' %}selected{% endif %}>Dominio Público</option>
                                    <option value="Dominio Privado" {% if error_data.Clasificacion_Legal == 'Dominio Privado' %}selected{% endif %}>Dominio Privado</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="Area_Presupuestal"><i class="fas fa-chart-pie icon-label"></i> Área Presupuestal</label>
                                <input type="text" name="Area_Presupuestal" value="{{ error_data.Area_Presupuestal or '' }}">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="Descripcion_Del_Bien"><i class="fas fa-align-left icon-label"></i> Descripción Completa</label>
                                <textarea name="Descripcion_Del_Bien" rows="3">{{ error_data.Descripcion_Del_Bien or '' }}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon"><i class="fas fa-dollar-sign"></i></div>
                            <h2>Datos Financieros</h2>
                        </div>
                        
                        <div class="form-grid-3">
                            <div class="form-group">
                                <label>No. de Factura</label>
                                <input type="text" name="No_Factura" value="{{ error_data.No_Factura or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Fecha de Factura</label>
                                <input type="date" name="Fecha_Factura" value="{{ error_data.Fecha_Factura or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Costo Inicial</label>
                                <input type="number" step="0.01" name="Costo_Inicial" value="{{ error_data.Costo_Inicial or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Depreciación Acum.</label>
                                <input type="number" step="0.01" name="Depreciacion_Acumulada" value="{{ error_data.Depreciacion_Acumulada or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Costo Final</label>
                                <input type="number" step="0.01" name="Costo_Final" value="{{ error_data.Costo_Final or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Valor en Libros</label>
                                <input type="number" step="0.01" name="Valor_En_Libros" value="{{ error_data.Valor_En_Libros or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Póliza</label>
                                <input type="text" name="Poliza" value="{{ error_data.Poliza or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Fecha de Póliza</label>
                                <input type="date" name="Fecha_Poliza" value="{{ error_data.Fecha_Poliza or '' }}">
                            </div>
                            <div class="form-group">
                                <label>No. de Cuenta</label>
                                <input type="text" name="No_Cuenta" value="{{ error_data.No_Cuenta or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Subcuenta Arm.</label>
                                <input type="text" name="Sub_Cuenta_Armonizadora" value="{{ error_data.Sub_Cuenta_Armonizadora or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Rubro</label>
                                <input type="text" name="Rubro" value="{{ error_data.Rubro or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Proveedor</label>
                                <input type="text" name="Proveedor" value="{{ error_data.Proveedor or '' }}">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon"><i class="fas fa-file-alt"></i></div>
                            <h2>Información Adicional</h2>
                        </div>
                        <div class="form-grid-3">
                            <div class="form-group">
                                <label>Documento Propiedad</label>
                                <input type="text" name="Documento_Propiedad" value="{{ error_data.Documento_Propiedad or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Fecha Documento</label>
                                <input type="date" name="Fecha_Documento_Propiedad" value="{{ error_data.Fecha_Documento_Propiedad or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Fecha Adquisición</label>
                                <input type="date" name="Fecha_Adquisicion_Alta" value="{{ error_data.Fecha_Adquisicion_Alta or '' }}">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon"><i class="fas fa-user-shield"></i></div>
                            <h2>Datos del Resguardo</h2>
                        </div>
                        <div class="form-grid-3">
                            <div class="form-group">
                                <label><i class="fas fa-building icon-label"></i> Área *</label>
                                <select name="Area" required>
                                    <option value="">Selecciona un área</option>
                                    {% for area_name in areas %}
                                        <option value="{{ area_name }}" {% if error_data.Area == area_name %}selected{% endif %}>{{ area_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>No. de Resguardo</label>
                                <input type="text" name="No_Resguardo" value="{{ error_data.No_Resguardo or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Ubicación Física</label>
                                <input type="text" name="Ubicacion" value="{{ error_data.Ubicacion or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Tipo de Resguardo</label>
                                <select name="Tipo_De_Resguardo">
                                    <option value="0" {% if error_data.Tipo_De_Resguardo == 0 %}selected{% endif %}>Resguardo Normal</option>
                                    <option value="1" {% if error_data.Tipo_De_Resguardo == 1 %}selected{% endif %}>Sujeto de Control</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Fecha de Resguardo</label>
                                <input type="date" name="Fecha_Resguardo" value="{{ error_data.Fecha_Resguardo or '' }}">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon"><i class="fas fa-user"></i></div>
                            <h2>Información del Resguardante</h2>
                        </div>
                        <div class="form-grid-3">
                            <div class="form-group">
                                <label>Nombre del Resguardante</label>
                                <input type="text" name="Nombre_Del_Resguardante" value="{{ error_data.Nombre_Del_Resguardante or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Puesto</label>
                                <input type="text" name="Puesto_Trabajador" value="{{ error_data.get('Puesto', error_data.get('Puesto_Trabajador', '')) }}">
                            </div>
                            <div class="form-group">
                                <label>RFC</label>
                                <input type="text" name="RFC_Trabajador" value="{{ error_data.RFC_Trabajador or '' }}" maxlength="13">
                            </div>
                            <div class="form-group">
                                <label>No. de Trabajador</label>
                                <input type="text" name="No_Trabajador" value="{{ error_data.No_Trabajador or '' }}">
                            </div>
                            <div class="form-group">
                                <label>No. de Nómina</label>
                                <input type="number" name="No_Nomina_Trabajador" value="{{ error_data.No_Nomina_Trabajador or '' }}">
                            </div>
                            <div class="form-group full-width">
                                <label>Nombre Director/Jefe</label>
                                <input type="text" name="Nombre_Director_Jefe_De_Area" value="{{ error_data.Nombre_Director_Jefe_De_Area or '' }}">
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <a href="{{ url_for('excel_import.handle_errors') }}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Guardar Corrección
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    /* VARIABLES */
    :root {
        --col-burgundy: #6A2E4D;
        --col-burgundy-dark: #551E3A;
        --col-beige: #BC9B6A;
        --col-beige-light: #fdfbf7;
        --col-white: #ffffff;
        --col-bg: #f9fafb;
        --radius: 12px;
        --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        
        --alert-red-bg: #fef2f2;
        --alert-red-border: #f87171;
        --alert-red-text: #991b1b;
        --alert-red-icon: #ef4444;
    }

    /* Layout */
    .page-wrapper { min-height: 100vh; background: var(--col-bg); padding: 2rem 1rem; }
    .container-limit { max-width: 1200px; margin: 0 auto; }
    .mb-4 { margin-bottom: 1.5rem; }

    /* Header */
    .header-card {
        background: linear-gradient(to right, var(--col-burgundy), var(--col-burgundy-dark));
        border-radius: var(--radius); padding: 1.5rem 2rem; color: white;
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 2rem; box-shadow: var(--shadow);
    }
    .header-text h1 { margin: 0; font-size: 1.5rem; }
    .header-text p { margin: 0.5rem 0 0; color: #e2e8f0; }
    .header-icon-box {
        width: 48px; height: 48px; background: var(--col-beige); border-radius: 50%;
        display: flex; align-items: center; justify-content: center; color: var(--col-burgundy); font-size: 1.2rem;
    }

    /* Badge ID */
    .badge-mono { background: rgba(255,255,255,0.2); padding: 0.2rem 0.6rem; border-radius: 6px; font-family: monospace; font-size: 0.9rem; border: 1px solid rgba(255,255,255,0.3); }

    /* Card Principal */
    .card { background: var(--col-white); border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid #e5e7eb; }
    .card-body { padding: 2rem; }

    /* Alerta de Error */
    .alert-danger {
        background: var(--alert-red-bg); border-left: 4px solid var(--alert-red-border);
        padding: 1rem; border-radius: 4px; display: flex; gap: 1rem; align-items: flex-start;
    }
    .alert-icon { color: var(--alert-red-icon); font-size: 1.2rem; margin-top: 2px; }
    .alert-content { color: var(--alert-red-text); font-size: 0.95rem; }
    .alert-content p { margin: 0.2rem 0 0 0; }

    /* Formularios */
    .form-section { margin-bottom: 2.5rem; }
    .section-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; border-bottom: 1px solid #f3f4f6; padding-bottom: 0.5rem; }
    .section-icon { width: 32px; height: 32px; background: var(--col-burgundy); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
    .section-header h2 { color: var(--col-burgundy); font-size: 1.2rem; margin: 0; }

    .form-grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
    .full-width { grid-column: 1 / -1; }
    
    .form-group { display: flex; flex-direction: column; gap: 0.5rem; }
    .form-group label { font-size: 0.9rem; font-weight: 600; color: #374151; }
    .icon-label { color: var(--col-burgundy); margin-right: 0.3rem; }
    
    input, select, textarea {
        width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px; font-size: 0.95rem;
    }
    input:focus, select:focus, textarea:focus { outline: none; border-color: var(--col-burgundy); box-shadow: 0 0 0 3px rgba(106, 46, 77, 0.1); }
    textarea { resize: none; }

    /* Botones */
    .form-actions { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 1rem; }
    .btn { padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; border: none; cursor: pointer; transition: all 0.2s; }
    .btn-primary { background: linear-gradient(to right, var(--col-burgundy), var(--col-burgundy-dark)); color: white; }
    .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
    .btn-secondary { background: white; border: 1px solid var(--col-beige); color: var(--col-burgundy); }
    .btn-secondary:hover { background: #fdfbf7; }

    /* Móvil */
    @media (max-width: 640px) {
        .header-card { flex-direction: column; text-align: center; }
        .form-actions { flex-direction: column; }
        .btn { width: 100%; justify-content: center; }
    }
</style>
{% endblock %}