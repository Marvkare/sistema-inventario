{% extends "base.html" %}

{% block title %}Historial de Traspasos{% endblock %}

{% block content %}
<div class="page-wrapper">
    <div class="container-limit">
        
        <div class="header-card">
            <div class="header-text">
                <h1>Historial de Traspasos</h1>
                <p>Consulta todos los traspasos de bienes registrados en el sistema</p>
            </div>
            <div class="header-icon-box">
                <i class="fas fa-exchange-alt"></i>
            </div>
        </div>

        <div class="card search-card">
            <div class="card-body">
                <div class="search-flex">
                    <form method="GET" action="{{ url_for('traspaso.ver_traspasos') }}" class="search-form">
                        <div class="input-with-icon">
                            <i class="fas fa-search icon"></i>
                            <input type="search" name="q" value="{{ search_query or '' }}"
                                   placeholder="Buscar por No. Inventario, Resguardante...">
                        </div>
                    </form>
                    <div class="search-info">
                        <i class="fas fa-info-circle"></i>
                        <span><strong>{{ traspasos|length }}</strong> traspaso(s) encontrado(s)</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card table-card">
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>No. Inventario</th>
                            <th>Fecha Traspaso</th>
                            <th>Movimiento</th>
                            <th class="text-center">No. de Oficios</th>
                            <th class="text-right">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for traspaso in traspasos %}
                        <tr>
                            <td>
                                <div class="cell-flex">
                                    <div class="icon-circle icon-burgundy">
                                        <i class="fas fa-barcode"></i>
                                    </div>
                                    <span class="font-mono font-bold">{{ traspaso.No_Inventario }}</span>
                                </div>
                            </td>
                            
                            <td>
                                <div class="date-info">
                                    <span class="date-main"><i class="fas fa-calendar-alt"></i> {{ traspaso.fecha_traspaso.strftime('%d/%m/%Y') }}</span>
                                    <span class="date-sub">{{ traspaso.fecha_traspaso.strftime('%H:%M') }}</span>
                                </div>
                            </td>
                            
                            <td>
                                <div class="movement-stack">
                                    <div class="movement-row">
                                        <div class="icon-dot dot-red"><i class="fas fa-arrow-left"></i></div>
                                        <div class="movement-text">
                                            <span class="person">{{ traspaso.Resguardante_Anterior }}</span>
                                            <span class="area">{{ traspaso.Area_Anterior }}</span>
                                        </div>
                                    </div>
                                    <div class="movement-row">
                                        <div class="icon-dot dot-green"><i class="fas fa-arrow-right"></i></div>
                                        <div class="movement-text">
                                            <span class="person text-green">{{ traspaso.Resguardante_Actual }}</span>
                                            <span class="area">{{ traspaso.Area_Actual }}</span>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            
                            <td class="text-center">
                                <span class="badge badge-blue">
                                    <i class="fas fa-file-contract"></i> {{ traspaso.numero_oficios }}
                                </span>
                            </td>
                            
                            <td class="text-right">
                                <a href="{{ url_for('traspaso.ver_detalles_traspaso', traspaso_id=traspaso.traspaso_id) }}" 
                                   class="btn btn-primary btn-sm">
                                    <i class="fas fa-eye"></i> Ver Detalles
                                </a>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div class="empty-content">
                                    {% if search_query %}
                                        <div class="icon-placeholder"><i class="fas fa-search"></i></div>
                                        <p>No se encontraron resultados para "<strong>{{ search_query }}</strong>"</p>
                                    {% else %}
                                        <div class="icon-placeholder"><i class="fas fa-exchange-alt"></i></div>
                                        <p>No hay traspasos registrados</p>
                                        <small>Los traspasos aparecerán aquí una vez que se realicen</small>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            {% if traspasos and traspasos|length > 0 %}
            <div class="table-footer">
                <span>Mostrando <strong>{{ traspasos|length }}</strong> registros</span>
            </div>
            {% endif %}
        </div>

        {% if traspasos and traspasos|length > 0 %}
        <div class="stats-grid">
            <div class="card stat-card">
                <div class="stat-icon bg-red-light text-red">
                    <i class="fas fa-user-slash"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">Traspasos Realizados</span>
                    <span class="stat-value">{{ traspasos|length }}</span>
                </div>
            </div>
            <div class="card stat-card">
                <div class="stat-icon bg-green-light text-green">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">Resguardantes</span>
                    <span class="stat-value">
                        {{ (traspasos|map(attribute='Resguardante_Anterior')|list + traspasos|map(attribute='Resguardante_Actual')|list)|unique|list|length }}
                    </span>
                </div>
            </div>
            <div class="card stat-card">
                <div class="stat-icon bg-blue-light text-blue">
                    <i class="fas fa-file-contract"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">Total de Oficios</span>
                    <span class="stat-value">{{ traspasos|sum(attribute='numero_oficios') }}</span>
                </div>
            </div>
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    /* VARIABLES */
    :root {
        --col-burgundy: #6A2E4D;
        --col-burgundy-dark: #551E3A;
        --col-beige: #BC9B6A;
        --col-beige-light: #fdfbf7;
        --radius: 12px;
        --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        
        /* Colores Semánticos */
        --bg-red-light: #fef2f2; --text-red: #ef4444;
        --bg-green-light: #f0fdf4; --text-green: #16a34a;
        --bg-blue-light: #eff6ff; --text-blue: #2563eb;
    }

    /* Layout */
    .page-wrapper { min-height: 100vh; background: #f9fafb; padding: 2rem 1rem; }
    .container-limit { max-width: 1280px; margin: 0 auto; }

    /* Header */
    .header-card {
        background: linear-gradient(to right, var(--col-burgundy), var(--col-burgundy-dark));
        border-radius: var(--radius); padding: 1.5rem 2rem; color: white;
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 2rem; box-shadow: var(--shadow);
    }
    .header-text h1 { margin: 0; font-size: 1.5rem; }
    .header-text p { margin: 0.5rem 0 0; color: #e2e8f0; }
    .header-icon-box {
        width: 48px; height: 48px; background: var(--col-beige); border-radius: 50%;
        display: flex; align-items: center; justify-content: center; color: var(--col-burgundy); font-size: 1.2rem;
    }

    /* Search Card */
    .card { background: white; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid #e5e7eb; overflow: hidden; margin-bottom: 1.5rem; }
    .card-body { padding: 1.5rem; }
    
    .search-flex { display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap; }
    .search-form { flex: 1; min-width: 300px; }
    
    .input-with-icon { position: relative; }
    .input-with-icon input {
        width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid #d1d5db; border-radius: 8px; outline: none;
    }
    .input-with-icon input:focus { border-color: var(--col-burgundy); box-shadow: 0 0 0 3px rgba(106,46,77,0.1); }
    .input-with-icon .icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #9ca3af; }
    
    .search-info { color: #6b7280; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem; }
    .search-info i { color: var(--col-burgundy); }

    /* Tabla */
    .table-responsive { overflow-x: auto; }
    .data-table { width: 100%; border-collapse: collapse; min-width: 900px; }
    .data-table th { text-align: left; padding: 1rem; background: #f9fafb; color: #374151; font-size: 0.85rem; text-transform: uppercase; font-weight: 600; }
    .data-table td { padding: 1rem; border-bottom: 1px solid #f3f4f6; vertical-align: middle; color: #4b5563; }
    .data-table tr:hover { background-color: #f9fafb; }
    .text-center { text-align: center; } .text-right { text-align: right; }

    /* Elementos de Tabla */
    .cell-flex { display: flex; align-items: center; gap: 0.8rem; }
    .font-mono { font-family: monospace; font-size: 0.9rem; color: #1f2937; }
    .font-bold { font-weight: 700; }
    
    .icon-circle { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; flex-shrink: 0; }
    .icon-burgundy { background: var(--col-burgundy); }

    .date-info { display: flex; flex-direction: column; }
    .date-main { font-size: 0.9rem; color: #374151; }
    .date-main i { color: var(--col-burgundy); margin-right: 0.3rem; }
    .date-sub { font-size: 0.75rem; color: #9ca3af; }

    /* Stack de Movimiento (De -> Para) */
    .movement-stack { display: flex; flex-direction: column; gap: 0.6rem; }
    .movement-row { display: flex; align-items: flex-start; gap: 0.6rem; }
    .icon-dot { width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: white; flex-shrink: 0; margin-top: 2px; }
    .dot-red { background: #fee2e2; color: #ef4444; }
    .dot-green { background: #dcfce7; color: #16a34a; }
    
    .movement-text { display: flex; flex-direction: column; line-height: 1.2; }
    .person { font-weight: 600; font-size: 0.9rem; color: #374151; }
    .area { font-size: 0.75rem; color: #6b7280; }
    .text-green { color: #166534; }

    /* Badge */
    .badge { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: inline-flex; align-items: center; gap: 0.3rem; }
    .badge-blue { background: #eff6ff; color: #1e40af; }

    /* Botones */
    .btn { padding: 0.5rem 1rem; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 0.85rem; display: inline-flex; align-items: center; gap: 0.4rem; border: none; cursor: pointer; transition: all 0.2s; }
    .btn-primary { background: linear-gradient(to right, var(--col-burgundy), var(--col-burgundy-dark)); color: white; }
    .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }

    /* Empty State */
    .empty-state { text-align: center; padding: 3rem !important; }
    .empty-content { display: flex; flex-direction: column; align-items: center; gap: 0.5rem; color: #9ca3af; }
    .icon-placeholder { width: 64px; height: 64px; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 0.5rem; }

    .table-footer { padding: 1rem 1.5rem; border-top: 1px solid #e5e7eb; background: #f9fafb; font-size: 0.85rem; color: #6b7280; }

    /* GRID ESTADÍSTICAS */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
    .stat-card { padding: 1.5rem; display: flex; align-items: center; gap: 1rem; margin-bottom: 0; }
    
    .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
    .bg-red-light { background: #fef2f2; } .text-red { color: #ef4444; }
    .bg-green-light { background: #f0fdf4; } .text-green { color: #16a34a; }
    .bg-blue-light { background: #eff6ff; } .text-blue { color: #2563eb; }
    
    .stat-info { display: flex; flex-direction: column; }
    .stat-label { font-size: 0.85rem; color: #6b7280; font-weight: 600; }
    .stat-value { font-size: 1.5rem; font-weight: 700; color: #1f2937; line-height: 1.2; }

    /* Móvil */
    @media (max-width: 768px) {
        .header-card { flex-direction: column; text-align: center; }
        .search-flex { flex-direction: column; align-items: stretch; }
        .search-info { justify-content: center; }
    }
</style>
{% endblock %}