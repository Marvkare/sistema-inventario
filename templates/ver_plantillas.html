{% extends "base.html" %}

{% block content %}
<div class="page-wrapper">
    <div class="container-limit">
        
        <div class="header-card">
            <div class="header-text">
                <h1>Mis Plantillas de Consulta</h1>
                <p>Gestiona y utiliza tus plantillas de consulta personalizadas.</p>
            </div>
            
            <div class="header-actions">
                <a href="{{ url_for('plantillas.crear_plantilla') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Crear Nueva Plantilla
                </a>
            </div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-wrapper">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        <i class="fas {% if category == 'success' %}fa-check-circle{% elif category == 'danger' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %}"></i>
                        <span>{{ message }}</span>
                    </div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="card">
            {% if templates %}
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Descripción</th>
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for template in templates %}
                        <tr>
                            <td>
                                <div class="template-info">
                                    <div class="icon-circle"><i class="fas fa-filter"></i></div>
                                    <div class="text-content">
                                        <span class="template-name">{{ template.name }}</span>
                                        <span class="template-date">Creada: {{ template.created_at.strftime('%d/%m/%Y') if template.created_at else 'N/A' }}</span>
                                    </div>
                                </div>
                            </td>
                            
                            <td>
                                <p class="template-desc">{{ template.description or 'Sin descripción' }}</p>
                            </td>
                            
                            <td class="text-center">
                                <div class="action-group">
                                    <a href="{{ url_for('plantillas.editar_plantilla', template_id=template.id) }}" 
                                       class="btn-action btn-blue" title="Editar">
                                        <i class="fas fa-edit"></i> <span>Editar</span>
                                    </a>
                                    
                                    <a href="{{ url_for('plantillas.exportar_excel', template_id=template.id) }}" 
                                       class="btn-action btn-green" title="Exportar a Excel">
                                        <i class="fas fa-file-excel"></i> <span>Excel</span>
                                    </a>
                                    
                                    <form action="{{ url_for('plantillas.eliminar_plantilla', template_id=template.id) }}" 
                                          method="post" class="inline-form"
                                          onsubmit="return confirm('¿Estás seguro de que quieres eliminar la plantilla \'{{ template.name }}\'?');">
                                        <button type="submit" class="btn-action btn-red" title="Eliminar">
                                            <i class="fas fa-trash-alt"></i> <span>Eliminar</span>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="card-footer">
                <div class="stats-badge">
                    <i class="fas fa-layer-group"></i>
                    <span>Total: <strong>{{ templates|length }}</strong> plantilla{{ 's' if templates|length != 1 }}</span>
                </div>
            </div>

            {% else %}
            <div class="empty-state">
                <div class="icon-placeholder"><i class="fas fa-filter"></i></div>
                <h3>No hay plantillas guardadas</h3>
                <p>Crea tu primera plantilla de consulta para personalizar y guardar tus búsquedas frecuentes.</p>
                <a href="{{ url_for('plantillas.crear_plantilla') }}" class="btn btn-primary mt-3">
                    <i class="fas fa-plus"></i> Crear Mi Primera Plantilla
                </a>
            </div>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    /* VARIABLES */
    :root {
        --col-burgundy: #6A2E4D;
        --col-burgundy-dark: #551E3A;
        --col-beige: #BC9B6A;
        --col-beige-light: #fdfbf7;
        --col-white: #ffffff;
        --col-bg: #f9fafb;
        --radius: 12px;
        --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        
        /* Colores de botones */
        --btn-blue: #2563eb; --btn-blue-hover: #1d4ed8;
        --btn-green: #16a34a; --btn-green-hover: #15803d;
        --btn-red: #dc2626; --btn-red-hover: #b91c1c;
    }

    /* Layout */
    .page-wrapper { min-height: 100vh; background: var(--col-bg); padding: 2rem 1rem; }
    .container-limit { max-width: 1100px; margin: 0 auto; }

    /* Header */
    .header-card {
        background: linear-gradient(to right, var(--col-burgundy), var(--col-burgundy-dark));
        border-radius: var(--radius); padding: 1.5rem 2rem; color: white;
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 2rem; box-shadow: var(--shadow); flex-wrap: wrap; gap: 1rem;
    }
    .header-text h1 { margin: 0; font-size: 1.5rem; }
    .header-text p { margin: 0.5rem 0 0; color: #e2e8f0; font-size: 0.9rem; }

    /* Flash Messages */
    .flash-wrapper { margin-bottom: 1.5rem; }
    .alert { padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid; display: flex; align-items: center; gap: 0.7rem; }
    .alert-success { background: #dcfce7; border-color: #22c55e; color: #14532d; }
    .alert-danger { background: #fee2e2; border-color: #ef4444; color: #7f1d1d; }
    .alert-info { background: #eff6ff; border-color: #3b82f6; color: #1e3a8a; }

    /* Card Principal */
    .card { background: var(--col-white); border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid #e5e7eb; overflow: hidden; }
    
    /* Tabla */
    .table-responsive { overflow-x: auto; }
    .data-table { width: 100%; border-collapse: collapse; min-width: 800px; }
    .data-table thead tr { background: linear-gradient(to right, #f9fafb, #f3f4f6); border-bottom: 2px solid #e5e7eb; }
    .data-table th { padding: 1rem; text-align: left; font-size: 0.85rem; font-weight: 600; color: var(--col-burgundy); text-transform: uppercase; }
    .data-table td { padding: 1rem; border-bottom: 1px solid #f3f4f6; vertical-align: middle; }
    .data-table tr:hover { background: #fdfbf7; }
    .text-center { text-align: center; }

    /* Info de Plantilla (Celda 1) */
    .template-info { display: flex; align-items: center; gap: 1rem; }
    .icon-circle { 
        width: 40px; height: 40px; background: rgba(106, 46, 77, 0.1); color: var(--col-burgundy);
        border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1rem;
    }
    .text-content { display: flex; flex-direction: column; }
    .template-name { font-weight: 700; color: #1f2937; font-size: 0.95rem; }
    .template-date { font-size: 0.75rem; color: #6b7280; }
    
    .template-desc { color: #4b5563; font-size: 0.9rem; max-width: 400px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    /* Botones de Acción */
    .action-group { display: flex; justify-content: center; gap: 0.5rem; }
    .inline-form { display: inline; }
    
    .btn-action {
        padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.8rem; font-weight: 600;
        text-decoration: none; display: inline-flex; align-items: center; gap: 0.4rem;
        color: white; border: none; cursor: pointer; transition: transform 0.2s;
    }
    .btn-action:hover { transform: translateY(-2px); }
    
    .btn-blue { background: var(--btn-blue); } .btn-blue:hover { background: var(--btn-blue-hover); }
    .btn-green { background: var(--btn-green); } .btn-green:hover { background: var(--btn-green-hover); }
    .btn-red { background: var(--btn-red); } .btn-red:hover { background: var(--btn-red-hover); }

    /* Botón Principal */
    .btn { padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.2s; }
    .btn-primary { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; }
    .btn-primary:hover { background: rgba(255,255,255,0.3); }
    .empty-state .btn-primary { background: var(--col-burgundy); border: none; } /* Botón en fondo blanco */
    .empty-state .btn-primary:hover { background: var(--col-burgundy-dark); }

    /* Footer Stats */
    .card-footer { padding: 1rem; background: #f9fafb; border-top: 1px solid #e5e7eb; }
    .stats-badge { 
        display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(188, 155, 106, 0.15); 
        padding: 0.3rem 0.8rem; border-radius: 6px; color: #374151; font-size: 0.85rem; 
    }
    .stats-badge strong { color: var(--col-burgundy); }

    /* Empty State */
    .empty-state { padding: 4rem 1rem; text-align: center; color: #9ca3af; }
    .icon-placeholder { 
        width: 80px; height: 80px; background: rgba(188, 155, 106, 0.1); color: var(--col-burgundy);
        border-radius: 50%; display: flex; align-items: center; justify-content: center; 
        font-size: 2rem; margin: 0 auto 1.5rem auto; 
    }
    .empty-state h3 { color: #374151; margin: 0 0 0.5rem 0; font-size: 1.25rem; }
    .empty-state p { max-width: 400px; margin: 0 auto; font-size: 0.95rem; }
    .mt-3 { margin-top: 1.5rem; }

    /* Móvil */
    @media (max-width: 768px) {
        .header-card { flex-direction: column; text-align: center; gap: 1rem; }
        .header-actions { width: 100%; justify-content: center; }
        .action-group { flex-direction: column; }
        .btn-action { justify-content: center; width: 100%; }
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    // Script simple para confirmar eliminación
    document.addEventListener('DOMContentLoaded', () => {
        console.log("Lista de plantillas cargada");
        // La lógica de 'onsubmit' ya está en línea en el HTML, 
        // pero aquí puedes agregar lógica global si lo deseas.
    });
</script>
{% endblock %}